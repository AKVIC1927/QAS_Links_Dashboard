<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QAS QUICK</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="android-chrome-512x512.png">
    <!-- âœ… Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css">
<style>
    /* âœ… Navbar Styling */

    .navbar-nav .nav-item .nav-link {
    transition: background 0.3s ease-in-out, transform 0.2s ease-in-out;
    }

    .navbar-nav .nav-item .nav-link:hover {
        background: #495057; /* Slightly different from navbar */
        color: #ffffff;
        border-radius: 5px;
    }

    .navbar {
    margin: 10px auto;
    border-radius: 10px;
    width: 95%;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    background-color: #343a40;
}


    /* âœ… Main Dropdown Menu Styling */
    .dropdown-menu {
        background-color: #343a40; /* Dark background */
        border: 1px solid #495057;
        min-width: 220px;
        padding: 0;
        border-radius: 5px;
    }

    /* âœ… Submenu Styling (Different Color) */
    .dropdown-submenu .dropdown-menu {
        background-color: #495057; /* Lighter gray for submenus */
        border: 1px solid #6c757d;
    }

    /* Dropdown Item Styling */
    .dropdown-item {
        color: white !important;
        padding: 10px 15px;
        font-size: 14px;
        transition: background 0.3s ease-in-out;
    }

    /* âœ… Different Hover Effects */
    .dropdown-item:hover {
        background-color: #495057 !important; /* Darker hover effect for main menu */
        color: #ffffff !important;
    }

    .dropdown-submenu .dropdown-item:hover {
        background-color: #6c757d !important; /* Even lighter hover effect for submenus */
        color: #ffffff !important;
    }

    /* âœ… Submenu Positioning */
    .dropdown-submenu {
        position: relative;
    }

    /* Submenus appear below the parent (Mobile View) */
    .dropdown-submenu .dropdown-menu {
        display: none;
        position: absolute;
        left: 100%;
        top: 0;
        margin-left: 0.2rem;
        border-radius: 5px;
    }

    /* Show Submenu on Hover (Desktop Only) */
    .dropdown-submenu:hover > .dropdown-menu {
        display: block;
    }

    /* Submenu Arrow Indicator */
    .dropdown-submenu > .dropdown-item::after {
        content: " â–¶";
        float: right;
        font-size: 12px;
    }

    /* âœ… Mobile View Improvements */
    @media (max-width: 992px) {
        .navbar-nav {
            width: 100%;
        }

        /* âœ… Dropdown in Mobile Mode (Full Width & Stacked) */
        .dropdown-menu {
            position: static;
            width: 100%;
            background-color: #343a40; /* Keep dark theme */
        }

        /* âœ… Submenus appear stacked (no floating to the side) */
        .dropdown-submenu .dropdown-menu {
            display: none;
            position: static;
            width: 100%;
            margin: 0;
            background-color: #495057; /* Keep submenu color consistent */
        }

        /* âœ… Show submenu when clicking */
        .dropdown-submenu.show > .dropdown-menu {
            display: block !important;
        }

        /* âœ… Change Arrow Direction for Mobile */
        .dropdown-submenu > .dropdown-item::after {
            content: "â–¼";
        }

        /* âœ… Navbar Toggle Button Styling */
        .navbar-toggler {
            border: 1px solid white;
            background-color: #495057;
            padding: 5px 10px;
            border-radius: 5px;
        }

        .navbar-toggler-icon {
            filter: invert(1);
        }

        /* Fix Collapsed Menu Spacing */
        .collapse.show {
            background-color: #343a40;
            padding: 10px;
            border-radius: 5px;
        }
    }

    /* âœ… Iframe Container Styling */
    .iframe-container {
        width: 100%;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    iframe {
        width: 100%;
        height: 100%;
        border: none;
    }
    
    .nav-link {
    display: block;
    padding: var(--bs-nav-link-padding-y) var(--bs-nav-link-padding-x);
    font-size: var(--bs-nav-link-font-size);
    font-weight: var(--bs-nav-link-font-weight);
    color: white;
    text-decoration: none;
    background: 0 0;
    border: 0;
    transition: color .15s ease-in-out, background-color .15s ease-in-out, border-color .15s ease-in-out;
}

</style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <h3 id="selectedText" style="color: white; font-size: 16px; margin: 0;">
                    Viewing: ALL - In Yard
                </h3>
                
            </a>

            <!-- âœ… Toggle button for mobile menu -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="https://akvic1927.github.io/QAS---In-Yard/">Adesa Form</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="dashboardDropdown" role="button" data-bs-toggle="dropdown">
                            Dashboard Links
                        </a>
                        <ul class="dropdown-menu" id="dynamicMenu"></ul>
                    </li>
                    
                    <!-- ðŸš€ Add New Link Button (Beside Dashboard Links) -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle btn btn-outline-light ms-3" href="#" id="addLinkDropdown" role="button" data-bs-toggle="dropdown">
                            âž• Add Link
                        </a>
                        <ul class="dropdown-menu p-3" id="addLinkMenu">
                            <li>
                                <div class="text-white">
                                    <strong>Add New Link</strong>
                                    <div class="mt-2">
                                        <select id="categoryDropdown" class="form-select">
                                            <option value="">Select Category</option>
                                        </select>
                                        <input type="text" id="newCategory" class="form-control mt-2" placeholder="Or enter new category">
                                        <input type="text" id="newLinkName" class="form-control mt-2" placeholder="Enter Link Name">
                                        <input type="text" id="newLinkURL" class="form-control mt-2" placeholder="Enter Link URL">
                                        <button class="btn btn-success w-100 mt-2" onclick="addNewLink()">Add</button>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </li>
                    
                                            
                </ul>
                <div class="toggle-container">
                    <label for="toggleOpenMode" style="color: white;">New Tab:</label>
                    <input type="checkbox" id="toggleOpenMode" onchange="toggleOpenMode()">
                </div>
            </nav>
        </div>
    </div>

    <div class="container-fluid iframe-container">
        <iframe frameborder="0" 
                id="dashboardFrame" 
                src="https://dashboard.transcanauto.com/#/superAdmin/vehicles/yard/?query=U2FsdGVkX19H7UG3xgW4W7j2MZ6ahaOl9ABB5JkmfgwcyPj8NLjY%2FYvblXcOFmNSUobOMewU2djOaNcFMX0rKbbQWps911vDN94mFfrk8JHNVXL4Uek8xO8U%2Bo1tCAny">
        </iframe>
    </div>

    <!-- âœ… Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", () => {
    initializePage();
    loadLinks();
    setupDropdownBehavior();
    checkAutoFilter();
});

// ðŸ”¹ Default Page Setting
function initializePage() {
    let defaultCategory = "ALL";
    let defaultText = "In Yard";
    let defaultURL = "https://dashboard.transcanauto.com/#/superAdmin/vehicles/yard/?query=U2FsdGVkX19H7UG3xgW4W7j2MZ6ahaOl9ABB5JkmfgwcyPj8NLjY%2FYvblXcOFmNSUobOMewU2djOaNcFMX0rKbbQWps911vDN94mFfrk8JHNVXL4Uek8xO8U%2Bo1tCAny";

    let iframe = document.getElementById("dashboardFrame");
    let selectedText = document.getElementById("selectedText");

    iframe.src = defaultURL;
    selectedText.textContent = `Viewing: ${defaultCategory} - ${defaultText}`;
}

// ðŸ”¹ Load Dashboard Links into the Dropdown
async function loadLinks() {
    try {
        const response = await fetch("links.json");
        const data = await response.json();
        const menu = document.getElementById("dynamicMenu");
        menu.innerHTML = ""; // Clear existing menu

        for (const category in data) {
            let submenu = document.createElement("li");
            submenu.classList.add("dropdown-submenu");

            let categoryLink = document.createElement("a");
            categoryLink.classList.add("dropdown-item", "dropdown-toggle");
            categoryLink.href = "#";
            categoryLink.textContent = category;

            let subMenuList = document.createElement("ul");
            subMenuList.classList.add("dropdown-menu");

            for (const title in data[category]) {
                let listItem = document.createElement("li");
                let link = document.createElement("a");
                link.classList.add("dropdown-item");
                link.href = "#";
                link.textContent = title;
                link.onclick = () => {
                    handleNavigation(data[category][title], title, category);
                    return false;
                };
                listItem.appendChild(link);
                subMenuList.appendChild(listItem);
            }

            submenu.appendChild(categoryLink);
            submenu.appendChild(subMenuList);
            menu.appendChild(submenu);
        }
    } catch (error) {
        console.error("Error loading links:", error);
    }
}

// ðŸ”¹ Open in New Tab Toggle
let openInNewTab = false;
function toggleOpenMode() {
    openInNewTab = document.getElementById("toggleOpenMode").checked;
}

// ðŸ”¹ Handle Link Clicks
function handleNavigation(url, text, category) {
    if (openInNewTab) {
        window.open(url, "_blank");
    } else {
        reloadIframe(url, text, category);
        scrollToIframe();
    }
}

// ðŸ”¹ Reload the Iframe
function reloadIframe(url, text, category) {
    let iframe = document.getElementById("dashboardFrame");
    let selectedText = document.getElementById("selectedText");

    iframe.src = "";
    setTimeout(() => {
        iframe.src = url;
        selectedText.textContent = `Viewing: ${category} - ${text}`;
    }, 100);
}

// ðŸ”¹ Smooth Scroll to Iframe
function scrollToIframe() {
    document.querySelector(".iframe-container").scrollIntoView({
        behavior: "smooth",
        block: "start"
    });
}

// ðŸ”¹ Setup Dropdown Behaviors (Submenus & Auto-Close)
function setupDropdownBehavior() {
    document.querySelectorAll(".dropdown-submenu > a").forEach((element) => {
        element.addEventListener("click", (e) => {
            e.preventDefault();
            let submenu = e.target.nextElementSibling;
            if (submenu && submenu.classList.contains("dropdown-menu")) {
                submenu.classList.toggle("show");
            }
        });
    });

    document.addEventListener("click", (event) => {
        if (!event.target.closest(".dropdown")) {
            document.querySelectorAll(".dropdown-menu").forEach(menu => menu.classList.remove("show"));
        }
    });
}

// ðŸ”¹ Auto-Filter Logic (Applies Date Filters)
function checkAutoFilter() {
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.has("autoFilter")) {
        console.log("Auto-filter detected. Running script...");
        applyDateFilter();
    }
}

// ðŸ”¹ Apply Date Filter Logic
function applyDateFilter() {
    console.log("Applying date filter...");

    let filterButton = document.querySelector("th:nth-child(8) div > div > div > button");
    if (filterButton) {
        filterButton.click();
    } else {
        console.log("Filter button NOT found.");
        return;
    }

    setTimeout(() => setDateInput("th:nth-child(8) div > div > div > ul > li:nth-child(1) form fieldset:nth-child(1) div > input", -48), 1000);
    setTimeout(() => setDateInput("th:nth-child(8) div > div > div > ul > li:nth-child(1) form fieldset:nth-child(2) div > input", 0), 2000);
    setTimeout(() => clickApplyButton(), 3000);
}

// ðŸ”¹ Set Date Input Values
function setDateInput(selector, offsetHours) {
    let input = document.querySelector(selector);
    if (input) {
        let date = new Date();
        date.setHours(date.getHours() + offsetHours);
        input.value = date.toISOString().split("T")[0];
        input.dispatchEvent(new Event("change"));
    } else {
        console.log(`Date input not found: ${selector}`);
    }
}

// ðŸ”¹ Click "Apply" Button on Filters
function clickApplyButton() {
    let applyButton = document.querySelector("th:nth-child(8) div > div > div > ul div div button:nth-child(1)");
    if (applyButton) {
        applyButton.click();
    } else {
        console.log("Apply button NOT found.");
    }
}
</script>
</body>
</html>
